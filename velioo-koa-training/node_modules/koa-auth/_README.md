# koa-auth (NodeJS)

An opinionated authentication middleware framework.

## Installation

Simply get the package from NPM...

    npm install koa-auth

And require it inside your application:

    var koaAuth = require('koa-auth');

The key componentsare the Provider class and the Middleware initiator:

    var authProvider = new koaAuth.Provider(cfg);
    app.use(authProvider.middleware());

All the other functionality should be taken care of in your own application, or
by some third-party middleware stack.

## Modularity

This is a very modular architecture. It's pretty opinionated but it doesn't mean
you will be limited in what you can do with it. The whole opinion thingy is that
you must be able to implement almost every single method in this module so to
make it fit your own needs.

### Dependencies

There are some dependencies for the default implementation of this module. You
can rid yourself from these dependencies by overwriting the actual methods
involved.

* By default, the koa generator context must add a session object before the
Provider middleware is added to the application. You can, however, overwrite all
the functionality that requires a session and adapt it to your own needs.

## Configuration

## Authentication

## Handy Middleware

We've included some proof of concept middleware inside the core package.


## Authentication Levels

We've included a system of authenticaiton levels in this authentication
framework.

## Authentication Flow Control

Say we have an authentication method list with the following authentication
levels:

- (1) Cookie
- (2) Password
- (3) One of the above and a 2 factor cookie
- (3) Embedded password
- (4) 2-factor authentication in this session

A cool example of an actual necessary flow control is 2-factor authentication.
You can easily implement such an authentication by working with the different
authentication levels. Note that these levels can actually be set by the app
developer.

    // First route of the authenticaiton part. If no level 1 authentication is
    // detected, a loginform will be given back to the user. You can change this
    // to be a json response as well.
    app.use(requiresAuth(1, function *() {
      this.render('loginform');
    }));

    // If it does not have a level 3 authentication clearance, the fallback
    // function will be called. In this case level 3 means 2-factor verified by
    // at least a cookie.
    app.use(requiresAuth(3, function *() {

      // You already have someone signed in with the password but this person is
      // not verified in a 2-factor way. You can use this to prevent for example
      // risky financial transactions
      this.render('2-factor authentication');

    }));

Obviously more advanced middleware could  be made on top of this system. But
since this is an opinionated package, we've decided to include the foundation of
this system in the core package.
